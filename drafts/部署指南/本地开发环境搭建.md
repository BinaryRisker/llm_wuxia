# 本地开发环境搭建

## 环境准备

### 系统要求
- **操作系统**：Windows 10/11、macOS 10.12+、Linux
- **内存**：至少 4GB RAM
- **存储**：至少 2GB 可用空间
- **网络**：稳定的互联网连接

### 必需软件

#### 1. Git 安装
**Windows：**
```powershell
# 使用 Chocolatey
choco install git

# 或下载安装包
# 访问 https://git-scm.com/download/win
```

**macOS：**
```bash
# 使用 Homebrew
brew install git

# 或使用 Xcode Command Line Tools
xcode-select --install
```

**Linux (Ubuntu/Debian)：**
```bash
sudo apt update
sudo apt install git
```

#### 2. Rust 工具链安装
mdBook 需要 Rust 环境，安装 Rustup：

**所有平台：**
```bash
# 安装 Rustup
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Windows 用户也可以下载安装包
# 访问 https://rustup.rs/
```

安装完成后重启终端，验证安装：
```bash
rustc --version
cargo --version
```

#### 3. mdBook 安装
```bash
# 使用 Cargo 安装 mdBook
cargo install mdbook

# 验证安装
mdbook --version
```

#### 4. 可选插件安装
```bash
# 安装有用的插件
cargo install mdbook-mermaid      # 支持 Mermaid 图表
cargo install mdbook-katex        # 支持数学公式
cargo install mdbook-linkcheck    # 链接检查
cargo install mdbook-toc          # 自动生成目录
```

## 项目克隆和设置

### 1. 克隆项目
```bash
# 克隆项目到本地
git clone https://github.com/your-username/llm_wuxia.git

# 进入项目目录
cd llm_wuxia
```

### 2. 验证项目结构
确认项目包含以下核心文件：
```
llm_wuxia/
├── book.toml           # mdBook 配置文件
├── src/                # 源文件目录
│   ├── SUMMARY.md      # 目录结构
│   ├── README.md       # 首页
│   └── *.md           # 章节文件
└── theme/              # 主题文件
    └── css/
        └── wuxia.css
```

### 3. 本地构建测试
```bash
# 构建项目
mdbook build

# 检查输出
ls book/  # 应该看到生成的 HTML 文件
```

## 本地开发服务器

### 启动开发服务器
```bash
# 启动本地服务器（默认端口 3000）
mdbook serve

# 指定端口
mdbook serve --port 8080

# 指定主机地址（允许局域网访问）
mdbook serve --hostname 0.0.0.0
```

### 访问本地网站
- 默认地址：http://localhost:3000
- 自定义端口：http://localhost:8080

### 热重载功能
mdBook 支持热重载，修改源文件后会自动：
1. 重新构建项目
2. 刷新浏览器页面
3. 保持当前阅读位置

## 开发工作流

### 1. 创建新分支
```bash
# 为新功能创建分支
git checkout -b feature/new-chapter

# 为修复创建分支
git checkout -b fix/typo-correction
```

### 2. 编辑内容
使用任何 Markdown 编辑器编辑 `src/` 目录下的文件：

**推荐编辑器：**
- **VS Code**：免费，插件丰富
- **Typora**：所见即所得 Markdown 编辑器
- **Mark Text**：实时预览编辑器
- **Vim/Neovim**：命令行编辑器

**VS Code 推荐插件：**
```
- Markdown All in One
- Markdown Preview Enhanced
- markdownlint
- GitLens
- Chinese (Simplified) Language Pack
```

### 3. 实时预览
```bash
# 启动服务器并在后台运行
mdbook serve --port 3000 &

# 或使用 nohup 防止终端关闭时停止
nohup mdbook serve --port 3000 > /dev/null 2>&1 &
```

### 4. 提交更改
```bash
# 查看修改的文件
git status

# 添加修改的文件
git add src/

# 提交更改
git commit -m "feat: 添加第XX章内容"

# 推送到远程仓库
git push origin feature/new-chapter
```

## 开发技巧

### 1. 内容组织
- **文件命名**：使用数字前缀确保顺序
- **目录结构**：在 `SUMMARY.md` 中维护清晰的目录
- **链接管理**：使用相对路径引用其他章节

### 2. 图片处理
```bash
# 创建图片目录
mkdir -p src/images

# 在 Markdown 中引用图片
![图片描述](images/your-image.png)
```

### 3. 表格编辑
使用 Markdown 表格语法，建议使用表格生成工具：
- https://www.tablesgenerator.com/markdown_tables
- VS Code 的表格插件

### 4. 数学公式
如果安装了 mdbook-katex：
```markdown
行内公式：$E = mc^2$

块级公式：
$$
\sum_{i=1}^{n} x_i = x_1 + x_2 + \cdots + x_n
$$
```

### 5. Mermaid 图表
如果安装了 mdbook-mermaid：
````markdown
```mermaid
graph TD
    A[开始] --> B{是否满足条件?}
    B -->|是| C[执行操作]
    B -->|否| D[结束]
    C --> D
```
````

## 故障排除

### 常见问题

**1. mdBook 安装失败**
```bash
# 更新 Rust 工具链
rustup update

# 清理 Cargo 缓存
cargo clean

# 重新安装
cargo install mdbook --force
```

**2. 构建失败**
```bash
# 检查 Markdown 语法
mdbook test

# 查看详细错误信息
mdbook build --verbose
```

**3. 端口被占用**
```bash
# 查看端口占用情况
netstat -ano | findstr :3000    # Windows
lsof -i :3000                   # macOS/Linux

# 使用不同端口
mdbook serve --port 8080
```

**4. 热重载不工作**
- 检查文件权限
- 重启开发服务器
- 清除浏览器缓存

### 性能优化

**1. 减少构建时间**
```bash
# 仅构建变更的文件
mdbook watch

# 使用多线程构建
CARGO_BUILD_JOBS=4 mdbook build
```

**2. 优化图片**
- 压缩图片文件
- 使用适当的图片格式
- 控制图片尺寸

**3. 减少文件大小**
- 避免过长的单个文件
- 合理拆分章节
- 压缩 CSS 和 JS 文件

## 最佳实践

### 1. 代码规范
- 使用一致的 Markdown 格式
- 保持合理的行长度
- 使用语义化的标题层级

### 2. 协作规范
- 创建有意义的提交信息
- 定期同步主分支
- 及时解决合并冲突

### 3. 质量保证
```bash
# 运行测试
mdbook test

# 检查链接
mdbook-linkcheck

# 语法检查
markdownlint src/
```

### 4. 备份策略
- 定期推送到远程仓库
- 创建重要版本的标签
- 保持本地和远程同步

通过以上步骤，你就可以在本地搭建完整的开发环境，愉快地参与《LLM武侠演义》项目的开发了！